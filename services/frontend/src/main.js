import "bootstrap/dist/css/bootstrap.min.css";
import "bootstrap/dist/js/bootstrap.bundle.min.js";
import Home from "./views/Home";
import Profile from "./views/Profile";
import Settings from "./views/Settings";
import NotFound from "./views/NotFound";
import Counter from "./views/Counter";

const router = async () => {
    // Define routes and their associated views.
    // This allows us to dynamically render HTML content based on the current view.
    const routes = [
        { path: "/404", view: new NotFound() },
        { path: "/", view: new Home() },
        { path: "/profile", view: new Profile() },
        { path: "/settings", view: new Settings() },
        { path: "/counter", view: new Counter() },
    ];

    // Create an array of potential matches by mapping routes to their match status.
    // This helps us determine if the current path exists in our routes array.
    const potentialMatches = routes.map((route) => {
        return {
            route: route,
            isMatch: location.pathname === route.path,
        };
    });

    // TODO: Implement a 404 page for unmatched routes.
    let match = potentialMatches.find((potentialMatch) => potentialMatch.isMatch);
    if (!match) {
        match = {
            route: routes[0],
            isMatch: true,
        };
    }

    // Instantiate the view associated with the matched route.
    const view = match.route.view;

    view.updateHandler = async () => {
        document.getElementById("app").innerHTML = await view.render();
        view.events();
    };

    // Render the HTML content generated by the view class into the app placeholder.
    await view.update();

    // Handle browser navigation events (back/forward buttons).
    window.onpopstate = () => {
        router();
    };
};

// Update the browser's history with the new URL and render the corresponding view.
const navigateTo = (url) => {
    history.pushState(null, null, url);
    router();
};

// If the clicked element contains a data-link attribute, prevent the default page reload,
// update the browser's history, and render the new HTML content.
document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("click", (event) => {
        if (event.target.matches("[data-link]")) {
            event.preventDefault();
            navigateTo(event.target.href);
        }
    });
    router();
});
